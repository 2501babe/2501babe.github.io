(function(e){function t(t){for(var a,r,l=t[0],i=t[1],s=t[2],d=0,p=[];d<l.length;d++)r=l[d],Object.prototype.hasOwnProperty.call(o,r)&&o[r]&&p.push(o[r][0]),o[r]=0;for(a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a]);u&&u(t);while(p.length)p.shift()();return c.push.apply(c,s||[]),n()}function n(){for(var e,t=0;t<c.length;t++){for(var n=c[t],a=!0,l=1;l<n.length;l++){var i=n[l];0!==o[i]&&(a=!1)}a&&(c.splice(t--,1),e=r(r.s=n[0]))}return e}var a={},o={app:0},c=[];function r(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=a,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="revoken/";var l=window["webpackJsonp"]=window["webpackJsonp"]||[],i=l.push.bind(l);l.push=t,l=l.slice();for(var s=0;s<l.length;s++)t(l[s]);var u=i;c.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},1:function(e,t){},2:function(e,t){},3:function(e,t){},"37bb":function(e,t,n){var a=n("24fb");t=a(!1),t.push([e.i,"font-weight:700;",""]),e.exports=t},4:function(e,t){},5:function(e,t){},5001:function(e,t,n){var a=n("37bb");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var o=n("499e").default;o("2afda296",a,!0,{sourceMap:!1,shadowMode:!1})},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var a=n("7a23"),o=(n("d3b7"),n("25f0"),{class:"right"}),c=["disabled"],r=Object(a["e"])("option",null,"mainnet-beta",-1),l=Object(a["e"])("option",null,"testnet",-1),i=Object(a["e"])("option",null,"devnet",-1),s=Object(a["e"])("option",null,"localhost",-1),u=[r,l,i,s],d={key:0},p={key:1},b=Object(a["e"])("button",{disabled:!0},"phantom only sorry",-1),f=[b],h={key:2},O=["disabled"],j={key:0},m=Object(a["e"])("br",null,null,-1),g=Object(a["e"])("h1",null,"solana token revoken",-1),v={key:0},w=Object(a["e"])("p",null," the spl token program has an instruction called approve. approve is intended to function similar the ierc20 function of the same name: instead of signing a token account away to a program to modify as it pleases, you independently grant it a maximum budget it can use without further authorization ",-1),y=Object(a["e"])("div",{class:"center"},[Object(a["e"])("img",{src:"/img/hana-revoken-tweet.png",alt:"tiny brain: malicious solana program that rugs people who call it.\n                  giant dick: malicious solana program that tags people who call it\n                  with approvals and then rugs everyone all at once months later\n        "})],-1),k=Object(a["e"])("p",null," but thanks to how crossprogram calling works in solana this can actually be used against you. if you sign for a token account to a malicious program, it can call into the token program and use your signature to approve itself to withdraw an unlimited amount of that token at an arbitrary later date ",-1),x=Object(a["e"])("p",null," to be clear it could also just steal your tokens then and there. but a program may want to use approvals to a) fly under the radar for some time to massively increase its take, and b) fool phantoms new balance change simulator by not actually changing balances in the transaction you sign. this would be a really cool attack and would scare a lot of people i think ",-1),C=Object(a["e"])("p",null,' this is all because of another interesting ("interesting") difference between solana and ethereum. on ethereum, erc20 transfer always uses msg.sender as the token sender. it is not possible for a contract to avoid the twolegged approve and transferFrom flow. but on solana, theres only transfer, gated by either a wallet signature or an approval. crossprogram calls pass the hash so to speak, and programs cannot distinguish an intermediary from an origin ',-1),A=Object(a["e"])("p",null," anyway!! this is a client app that pulls your token accounts, checks for active approvals, and creates and sends transactions to revoke them at your pleasure ",-1),T=Object(a["e"])("p",null,[Object(a["f"])(" code available "),Object(a["e"])("a",{href:"https://github.com/2501babe/revoken"},"here")],-1),_={class:"center"},B=["disabled"],M={key:1},R=Object(a["e"])("p",null,"something happened",-1),S=[R],N={key:2},P=Object(a["e"])("p",null,"congrats! youre safe. isnt that what youve always wanted to hear?",-1),I=[P],z={key:3},K={class:"token-table"},D=Object(a["e"])("tr",null,[Object(a["e"])("th"),Object(a["e"])("th",null,"token"),Object(a["e"])("th",null,"account address"),Object(a["e"])("th",null,"mint address"),Object(a["e"])("th",null,"delegate address"),Object(a["e"])("th",null,"approved amount")],-1),F={class:"button-swap"},q={key:0},E=["onClick"],J={key:1},U={key:2},V=Object(a["e"])("strong",null,"âœ“",-1),G=[V],H=Object(a["e"])("td",null,"(unknown token)",-1),L={key:0},Q={key:1},W=Object(a["e"])("p",{class:"center"},[Object(a["e"])("a",{href:"/index.html"},"home")],-1);function X(e,t,n,r,l,i){var s=Object(a["m"])("Address"),b=Object(a["m"])("Dots");return Object(a["i"])(),Object(a["d"])(a["a"],null,[Object(a["e"])("div",o,[Object(a["q"])(Object(a["e"])("select",{disabled:l.walletConnected,"onUpdate:modelValue":t[0]||(t[0]=function(e){return l.selectedNetwork=e})},u,8,c),[[a["o"],l.selectedNetwork]]),l.walletConnected?(Object(a["i"])(),Object(a["d"])("span",d,[Object(a["e"])("button",{onClick:t[1]||(t[1]=function(e){return l.wallet.disconnect()})},"disconnect")])):l.wallet&&!i.phantom?(Object(a["i"])(),Object(a["d"])("span",p,f)):(Object(a["i"])(),Object(a["d"])("span",h,[Object(a["e"])("button",{disabled:!l.wallet,onClick:t[2]||(t[2]=function(e){return l.wallet.connect()})},"connect",8,O)])),Object(a["e"])("div",null,[Object(a["q"])(Object(a["e"])("span",null,[l.walletConnected?(Object(a["i"])(),Object(a["d"])("span",j,[Object(a["g"])(s,{pubkey:l.wallet.publicKey},null,8,["pubkey"])])):Object(a["c"])("",!0),Object(a["f"])("| "+Object(a["n"])(null==l.solBalance?"--":l.solBalance)+" sol ",1)],512),[[a["p"],l.walletConnected]]),m])]),g,null===l.tokens?(Object(a["i"])(),Object(a["d"])("div",v,[w,y,k,x,C,A,T,Object(a["e"])("div",_,[Object(a["e"])("button",{disabled:!l.walletConnected,onClick:t[3]||(t[3]=function(e){return i.fetchTokens()})},"lets do it",8,B)])])):void 0===l.tokens?(Object(a["i"])(),Object(a["d"])("div",M,S)):0==l.tokens.length?(Object(a["i"])(),Object(a["d"])("div",N,I)):(Object(a["i"])(),Object(a["d"])("div",z,[Object(a["e"])("table",K,[D,(Object(a["i"])(!0),Object(a["d"])(a["a"],null,Object(a["l"])(l.tokens,(function(e){return Object(a["i"])(),Object(a["d"])("tr",{key:e.address.toString()},[Object(a["e"])("td",F,["open"==e.revokeStatus?(Object(a["i"])(),Object(a["d"])("span",q,[Object(a["e"])("button",{onClick:function(t){return i.revoke(e)}},"revoke",8,E)])):"pending"==e.revokeStatus?(Object(a["i"])(),Object(a["d"])("span",J,[Object(a["g"])(b)])):"closed"==e.revokeStatus?(Object(a["i"])(),Object(a["d"])("span",U,G)):Object(a["c"])("",!0)]),H,Object(a["e"])("td",null,[Object(a["g"])(s,{pubkey:e.address},null,8,["pubkey"])]),Object(a["e"])("td",null,[Object(a["g"])(s,{pubkey:e.mint},null,8,["pubkey"])]),Object(a["e"])("td",null,[e.delegate?(Object(a["i"])(),Object(a["d"])("span",L,[Object(a["g"])(s,{pubkey:e.delegate},null,8,["pubkey"])])):(Object(a["i"])(),Object(a["d"])("span",Q,"--"))]),Object(a["e"])("td",null,Object(a["n"])(e.delegatedAmount),1)])})),128))])])),W],64)}var Y=n("1da1"),Z=(n("96cf"),n("b680"),n("4de4"),n("d81d"),n("64b9")),$=n("3e44");function ee(e,t,n,o,c,r){return Object(a["i"])(),Object(a["d"])("span",null,Object(a["n"])(c.dots),1)}var te={name:"Dots",mounted:function(){var e=this;setInterval((function(){""==e.dots?e.dots=".":". . ."==e.dots?e.dots="":e.dots=e.dots+" ."}),500)},data:function(){return{dots:""}}},ne=(n("cab0"),n("6b0d")),ae=n.n(ne);const oe=ae()(te,[["render",ee],["__scopeId","data-v-6e0b165f"]]);var ce=oe,re={class:"tooltip"},le=["title"];function ie(e,t,n,o,c,r){return Object(a["i"])(),Object(a["d"])("span",re,[Object(a["e"])("span",{class:Object(a["h"])(["tooltiptext",{active:c.copyTooltip}])},"copied!",2),Object(a["e"])("button",{title:r.address,onClick:t[0]||(t[0]=function(){return r.copy&&r.copy.apply(r,arguments)})},Object(a["n"])(r.pretty()),9,le)])}var se={name:"Address",props:{pubkey:Object},data:function(){return{copyTooltip:0}},computed:{address:function(){return this.pubkey.toString()}},methods:{pretty:function(){return this.address.substring(0,4)+"..."+this.address.substring(this.address.length-4)},copy:function(){var e=this;return Object(Y["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,navigator.clipboard.writeText(e.address);case 2:e.copyTooltip+=1,setTimeout((function(){return e.copyTooltip-=1}),2e3);case 4:case"end":return t.stop()}}),t)})))()}}};n("e9a4");const ue=ae()(se,[["render",ie],["__scopeId","data-v-0209aa8d"]]);var de=ue,pe={"mainnet-beta":"https://solana-api.projectserum.com",testnet:"https://api.testnet.solana.com",devnet:"https://api.devnet.solana.com",localhost:"http://127.0.0.1:8899"},be={name:"App",components:{Dots:ce,Address:de},mounted:function(){var e=window.revoken=this,t=setInterval((function(){window.solana&&(e.wallet=window.solana,window.solana.on("connect",(function(){e.walletConnected=!0,e.fetchBalance()})),window.solana.on("disconnect",(function(){e.walletConnected=!1,e.solBalance=null,e.tokens=null})),clearInterval(t))}),100);e.connectChain()},data:function(){return{connection:null,wallet:null,walletConnected:!1,solBalance:null,selectedNetwork:"mainnet-beta",tokens:null}},computed:{phantom:function(){return!(!this.wallet||!this.wallet.isPhantom)}},watch:{selectedNetwork:function(e,t){e!=t&&this.connectChain()}},methods:{connectChain:function(){this.connection=new Z["a"](pe[this.selectedNetwork])},parseTokenAccount:function(e,t){var n=$["a"].decode(t.data);return 0===n.delegateOption?null:(n.revokeStatus="open",n.address=e,n.mint=new Z["c"](n.mint),n.owner=new Z["c"](n.owner),n.amount=$["d"].fromBuffer(n.amount),0===n.delegateOption?(n.delegate=null,n.delegatedAmount=new $["d"]):(n.delegate=new Z["c"](n.delegate),n.delegatedAmount=$["d"].fromBuffer(n.delegatedAmount)),n.isInitialized=0!==n.state,n.isFrozen=2===n.state,1===n.isNativeOption?(n.rentExemptReserve=$["d"].fromBuffer(n.isNative),n.isNative=!0):(n.rentExemptReserve=null,n.isNative=!1),0===n.closeAuthorityOption?n.closeAuthority=null:n.closeAuthority=new Z["c"](n.closeAuthority),n)},fetchBalance:function(){var e=this;return Object(Y["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.connection.getBalance(e.wallet.publicKey).then((function(e){return(e/Math.pow(10,9)).toFixed(3)})).catch((function(){return null}));case 2:e.solBalance=t.sent;case 3:case"end":return t.stop()}}),t)})))()},fetchTokens:function(){var e=this;return Object(Y["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e,t.next=3,n.connection.getTokenAccountsByOwner(n.wallet.publicKey,{programId:$["b"]}).then((function(e){return e.value.map((function(e){return n.parseTokenAccount(e.pubkey,e.account)})).filter((function(e){return e}))})).catch((function(){}));case 3:e.tokens=t.sent;case 4:case"end":return t.stop()}}),t)})))()},revoke:function(e){var t=this;return Object(Y["a"])(regeneratorRuntime.mark((function n(){var a,o,c;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return a=new Z["f"],a.add($["c"].createRevokeInstruction($["b"],e.address,t.wallet.publicKey,[])),a.feePayer=t.wallet.publicKey,n.next=5,t.connection.getRecentBlockhash();case 5:return a.recentBlockhash=n.sent.blockhash,n.next=8,window.solana.signTransaction(a);case 8:return o=n.sent,n.next=11,t.connection.sendRawTransaction(o.serialize());case 11:return c=n.sent,e.revokeStatus="pending",n.next=15,t.connection.confirmTransaction(c);case 15:e.revokeStatus="closed",e.delegate=null,e.delegatedAmount=0;case 18:case"end":return n.stop()}}),n)})))()}}};n("d94f");const fe=ae()(be,[["render",X]]);var he=fe;Object(a["b"])(he).mount("#app")},6:function(e,t){},"920f":function(e,t,n){var a=n("9407");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var o=n("499e").default;o("41b9273b",a,!0,{sourceMap:!1,shadowMode:!1})},9407:function(e,t,n){var a=n("24fb");t=a(!1),t.push([e.i,"#app{margin:40px auto;max-width:800px;font:18px/1.5 sans-serif;padding:0 10px}h1,h2,h3{line-height:1.2}.center,h1,h2,h3{text-align:center}.right{text-align:right}.token-table{font:14px/1.2 sans-serif}button,select{cursor:pointer}button:disabled,select:disabled{cursor:not-allowed}.button-swap{text-align:center;display:inline-block;width:2.5em;height:1.2em}td,th{padding:0 10px}code{font-family:monospace;background-color:#eee}",""]),e.exports=t},cab0:function(e,t,n){"use strict";n("5001")},cc5b:function(e,t,n){var a=n("ff83");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var o=n("499e").default;o("ac8700e6",a,!0,{sourceMap:!1,shadowMode:!1})},d94f:function(e,t,n){"use strict";n("920f")},e9a4:function(e,t,n){"use strict";n("cc5b")},ff83:function(e,t,n){var a=n("24fb");t=a(!1),t.push([e.i,"button[data-v-0209aa8d]{font:inherit;background:none;border:none}.tooltip[data-v-0209aa8d]{position:relative;display:inline-block}.tooltiptext[data-v-0209aa8d]{font:14px/1.2 sans-serif;visibility:hidden;text-align:center;color:#fff;background:#000;padding:5px;position:absolute;z-index:1;bottom:1.5em;left:1em}.tooltiptext.active[data-v-0209aa8d]{visibility:visible}",""]),e.exports=t}});
//# sourceMappingURL=app.9a01f775.js.map